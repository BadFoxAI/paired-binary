<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paired Binary Interactive Explorer</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding: 20px; background-color: #f0f4f8; /* Slightly cooler background */
            color: #333; line-height: 1.6; display: flex; flex-direction: column; align-items: center;
        }
        .main-container {
            width: 100%; max-width: 960px; background-color: #fff;
            padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1, h2 { color: #1a237e; /* Indigo */ text-align: center; }
        h1 { font-size: 2.2em; margin-bottom: 10px; }
        h2 { font-size: 1.6em; margin-top: 25px; margin-bottom: 15px; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;}
        
        .status-panel { text-align: center; margin-bottom: 20px; padding: 10px; border-radius: 5px; font-weight: bold; }
        .status-ok { background-color: #dcedc8; /* Light Green */ color: #388e3c; }
        .status-error { background-color: #ffcdd2; /* Light Red */ color: #d32f2f; }
        .status-info { background-color: #bbdefb; /* Light Blue */ color: #1976d2; }

        .primary-visualization, .key-benchmark {
            padding: 20px; margin-bottom: 25px;
            border: 1px solid #c5cae9; /* Indigo Light */
            border-radius: 8px; background-color: #f8f9fa;
        }
        .primary-visualization p, .key-benchmark p { text-align: center; margin-bottom: 15px; color: #555; }
        #s6Canvas { display: block; margin: 0 auto; border: 1px solid #9fa8da; background-color: #fff; }

        button {
            background-color: #3f51b5; /* Indigo */ color: white;
            padding: 12px 20px; border: none; border-radius: 5px;
            cursor: pointer; font-size: 1em; font-weight: bold;
            transition: background-color 0.2s ease, transform 0.1s ease;
            display: inline-block; /* Changed for more flexible layout */
            margin: 5px;
        }
        button:hover { background-color: #303f9f; transform: translateY(-1px); }
        button:active { background-color: #283593; transform: translateY(0px); }
        button.secondary-action { background-color: #7986cb; /* Indigo Light */ }
        button.secondary-action:hover { background-color: #5c6bc0; }


        details {
            background-color: #f1f3f5; border: 1px solid #dee2e6;
            border-radius: 6px; margin-top: 25px;
        }
        summary {
            font-weight: bold; font-size: 1.2em; color: #343a40;
            padding: 12px 18px; cursor: pointer; background-color: #e9ecef;
            border-radius: 6px; transition: background-color 0.2s ease;
        }
        details[open] summary { border-bottom: 1px solid #dee2e6; border-radius: 6px 6px 0 0;}
        summary:hover { background-color: #ced4da; }
        .details-content { padding: 20px; }

        .control-group { margin-bottom: 15px; padding: 10px; border-radius: 4px; background-color: #fff; }
        .control-group label { display: block; margin-bottom: 4px; font-weight: normal; color: #495057; font-size: 0.9em; }
        .control-group input[type="text"],
        .control-group input[type="number"],
        .control-group select {
            width: calc(100% - 20px); padding: 8px; margin-bottom: 8px;
            border: 1px solid #ced4da; border-radius: 3px; box-sizing: border-box; font-size: 0.95em;
        }
        .control-group button { width: auto; font-size: 0.9em; padding: 8px 15px; } /* Smaller buttons in details */

        #mainOutputArea, #benchmarkResultArea {
            margin-top: 15px; padding: 12px; border: 1px solid #ced4da; border-radius: 4px;
            background-color: #e9ecef; min-height: 40px; font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap; font-size: 0.9em;
        }
        #fullOutputLog { display:none; width: 100%; height: 250px; font-family: 'Courier New', Courier, monospace; font-size: 0.85em; border: 1px solid #ced4da; border-radius: 4px; padding: 8px; box-sizing: border-box; background-color: #f8f9fa; white-space: pre-wrap; overflow-y: auto; margin-top: 10px;}
        .log-controls button { width: auto; display: inline-block; margin-right: 8px; padding: 6px 10px; font-size: 0.85em;}

    </style>
</head>
<body>
    <div class="main-container">
        <h1>Paired Binary Interactive Explorer</h1>
        <div id="wasmStatus" class="status-indicator status-info">Loading WASM...</div>
        <div id="mainOutputArea"><p><i>Status and results of primary actions will appear here.</i></p></div>

        <section class="primary-visualization">
            <h2>S6 Dot Visualization (for S3={0,1,2})</h2>
            <p>Displays the 9 members of S6 generated from S_base={0,1,2} with N_base=3. Each dot is an X-value. (Click "Draw S6 Plot")</p>
            <div style="text-align:center;">
                 <button onclick="drawS6Visualization()" id="drawS6Button">Draw S6 Plot</button>
            </div>
            <canvas id="s6Canvas" width="360" height="360" style="margin-top:15px;"></canvas>
        </section>

        <section class="key-benchmark">
            <h2>Key Performance Metric</h2>
            <p>Test how large 'N' can be for `generate_random_member` + `is_member` to complete within a target time.
               (This sets S_base to {0,1,2}, N_base=3 for the test.)</p>
            <label for="depthTestTimeLimit">Time Limit per N (ms):</label>
            <input type="number" id="depthTestTimeLimit" value="500" style="width:100px; display:inline-block; margin-right:10px;">
            <button onclick="runDepthTest()" id="depthTestButton">Run Max N Depth Test</button>
            <div id="benchmarkResultArea" style="margin-top:15px;"><p><i>Depth test results will appear here.</i></p></div>
        </section>

        <details id="advancedControlsDetails">
            <summary>Advanced Controls & Tests Â»</summary>
            <div class="details-content">
                <h2>Propagator Setup</h2>
                <div class="control-group">
                    <label for="sBaseValuesInput">S_base Values (comma-separated):</label>
                    <input type="text" id="sBaseValuesInput" value="0,1,2">
                    <label for="nBaseBitsInput">N_base Bits:</label>
                    <input type="number" id="nBaseBitsInput" value="3" min="1">
                    <button onclick="setupWasmPropagator()">Initialize / Update Propagator</button>
                </div>

                <h2>Automated Basic Tests</h2>
                <div class="control-group">
                    <button class="test-suite-button" onclick="runAutomatedTests()">Run Basic Logic Test Suite</button>
                </div>
                
                <h2>Performance Tests (Manual)</h2>
                <div class="control-group">
                    <h3>Run Speed Test</h3>
                    <label for="perfTestFunction">Function to Test:</label>
                    <select id="perfTestFunction">
                        <option value="is_member">is_member</option>
                        <option value="decompose_to_base">decompose_to_base</option>
                        <option value="compose_from_base">compose_from_base</option>
                        <option value="generate_random_member">generate_random_member</option>
                        <option value="create_paired_entity">create_paired_entity</option>
                    </select>
                    <label for="perfTestNValue">Target N-bits:</label>
                    <input type="number" id="perfTestNValue" value="12">
                     <label for="perfTestXValue">X Value for test (if applicable):</label>
                    <input type="text" id="perfTestXValue" value="0">
                    <label for="perfTestIterations">Number of Iterations:</label>
                    <input type="number" id="perfTestIterations" value="1000">
                    <button onclick="runPerformanceTest()">Start Manual Perf Test</button>
                </div>

                <h2>Manual Function Tests</h2>
                 <!-- ... Individual Manual Test Sections (Paired Entity, IsMember, etc.) go here, same HTML as before ... -->
                <h3>Create Paired Entity</h3>
                <div class="control-group">
                    <label for="peXValueInput">X Value (decimal string):</label>
                    <input type="text" id="peXValueInput" value="2">
                    <label for="peNBitsInput">N-bits:</label>
                    <input type="number" id="peNBitsInput" value="3" min="1">
                    <button onclick="runCreatePairedEntity()">Create Paired Entity</button>
                </div>
                 <h3>Test S_N Membership</h3>
                <div class="control-group"> /* ... and so on for other manual tests ... */ </div>
            </div>
        </details>

        <div id="fullLogContainer">
            <h2>Verbose Log</h2>
            <div class="log-controls">
                <button onclick="toggleFullLog()" class="secondary-action">Toggle Full Log Display</button>
                <button onclick="exportFullLog()" class="secondary-action">Export Full Log</button>
                <button onclick="clearFullLog()" class="secondary-action">Clear Full Log</button>
            </div>
            <textarea id="fullOutputLog" readonly></textarea>
        </div>
    </div>

    <script type="module">
        import init, { 
            setup_propagator, 
            is_member, 
            decompose_to_base, 
            compose_from_base,
            generate_random_member,
            create_paired_entity 
        } from './pkg/paired_binary.js';

        const mainOutputArea = document.getElementById('mainOutputArea');
        const benchmarkResultArea = document.getElementById('benchmarkResultArea');
        const fullOutputLog = document.getElementById('fullOutputLog');
        const wasmStatusDiv = document.getElementById('wasmStatus');
        let wasmInitialized = false;
        let currentSBaseForDisplay = "0,1,2"; 
        let currentNBaseForDisplay = 3;
        let isBenchmarking = false; // Flag to prevent multiple benchmarks

        function displayMain(message, type = "info") {
            mainOutputArea.innerHTML = `<p class="status-${type}">${message}</p>`;
            if (type === "error") console.error("MainDisplay:", message);
            else console.log("MainDisplay:", message);
        }

        function verboseLog(message, context = "Generic") { /* ... same as before ... */
            console.log(`[${context}]`, message);
            const timestamp = new Date().toLocaleTimeString();
            const currentLogVal = fullOutputLog.value;
            const maxLogLength = 50000; 
            const entry = `${timestamp}: [${context}] ${typeof message === 'string' ? message : JSON.stringify(message, null, 2)}\n\n`;
            fullOutputLog.value = (currentLogVal + entry).slice(-maxLogLength);
            if (fullOutputLog.style.display !== 'none') {
                fullOutputLog.scrollTop = fullOutputLog.scrollHeight;
            }
        }
        
        async function initializeWasm() {
            if (wasmInitialized) return true;
            wasmStatusDiv.textContent = "Loading WASM...";
            wasmStatusDiv.className = "status-indicator status-info";
            try {
                await init(); 
                wasmStatusDiv.textContent = "WASM Module Initialized Successfully.";
                wasmStatusDiv.className = "status-indicator status-ok";
                verboseLog("WASM module initialized successfully.", "System");
                wasmInitialized = true;
                // Setup default propagator when WASM loads (S3={0,1,2})
                try {
                    setup_propagator("0,1,2", 3); 
                    currentSBaseForDisplay = "0,1,2";
                    currentNBaseForDisplay = 3;
                    verboseLog("Default propagator S3={0,1,2} initialized.", "System");
                } catch (e) {
                    verboseLog(`Error setting up default propagator: ${e}`, "System");
                    displayMain(`Error setting up default propagator: ${e}`, "error");
                }
                return true;
            } catch (e) {
                wasmStatusDiv.textContent = "WASM Initialization Failed! Check console.";
                wasmStatusDiv.className = "status-indicator status-error";
                verboseLog(`WASM Initialization Failed: ${e}`, "System");
                wasmInitialized = false;
                return false;
            }
        }
        
        // Propagator setup (called by button in advanced)
        window.setupWasmPropagator = async () => { 
            if (!await initializeWasm()) return;
            const sBaseValuesStr = document.getElementById('sBaseValuesInput').value;
            const nBaseBits = parseInt(document.getElementById('nBaseBitsInput').value);
            currentSBaseForDisplay = sBaseValuesStr; 
            currentNBaseForDisplay = nBaseBits;
            try {
                setup_propagator(sBaseValuesStr, nBaseBits);
                displayMain(`Propagator initialized/updated: S_base='${sBaseValuesStr}', N_base=${nBaseBits}`);
                verboseLog(`Propagator user-updated: S_base='${sBaseValuesStr}', N_base=${nBaseBits}`, "Setup");
            } catch (e) {
                const errorStr = (e instanceof Error) ? `${e.name}: ${e.message}` : String(e);
                displayMain(`Setup Propagator Error: ${errorStr}`, "error");
                verboseLog(`Error setting up propagator: ${errorStr}`, "Setup");
            }
        };
        
        async function runWasmOpForDisplay(actionName, operationFunc, ...args) {
            if (!await initializeWasm()) return "WASM not ready";
            displayMain(`${actionName}: Processing...`, "info");
            const startTime = performance.now();
            try {
                const result = await operationFunc(...args);
                const endTime = performance.now();
                const timedResult = { result: result, time_ms: (endTime - startTime).toFixed(3) };
                displayMain(`${actionName} Complete.`, "ok");
                verboseLog({action: actionName, inputs: args.map(String), ...timedResult}, "ManualOp");
                return result; 
            } catch (e) {
                const errorStr = (e instanceof Error) ? `${e.name}: ${e.message}` : String(e);
                displayMain(`${actionName} Error: ${errorStr}`, "error");
                verboseLog(`Error in ${actionName}: ${errorStr}`, "ManualOp");
                throw e; 
            }
        }

        window.runCreatePairedEntity = () => { /* Uses runWasmOpForDisplay */ 
            const x = document.getElementById('peXValueInput').value;
            const n = parseInt(document.getElementById('peNBitsInput').value);
            runWasmOpForDisplay("CreatePairedEntity", create_paired_entity, x, n);
        };
        window.runIsMember = () => {  /* Uses runWasmOpForDisplay */
            const x = document.getElementById('memberXValueInput').value;
            const n = parseInt(document.getElementById('memberNBitsInput').value);
            runWasmOpForDisplay("IsMember", is_member, x, n);
        };
        window.runDecompose = async () => { /* Uses runWasmOpForDisplay, custom result handling */
            const x = document.getElementById('decomposeXValueInput').value;
            const n = parseInt(document.getElementById('decomposeNBitsInput').value);
            await runWasmOpForDisplay("Decompose", async (val, bits) => {
                 const wasm_array = decompose_to_base(val, bits);
                 const nativeJsArray = Array.from(wasm_array);
                 return nativeJsArray.map(jsVal => (typeof jsVal === 'string') ? jsVal : (jsVal && typeof jsVal.as_string === 'function') ? jsVal.as_string() : String(jsVal));
            }, x, n);
        };
        window.runCompose = () => { /* Uses runWasmOpForDisplay */
            const compsStr = document.getElementById('composeComponentsInput').value;
            const compsArr = compsStr.split(',').map(s => s.trim()).filter(s => s.length > 0);
            runWasmOpForDisplay("Compose", compose_from_base, compsArr);
        };
        window.runGenerateRandom = () => { /* Uses runWasmOpForDisplay */
            const n = parseInt(document.getElementById('randomNBitsInput').value);
            const seed = parseInt(document.getElementById('randomSeedOffsetInput').value);
            runWasmOpForDisplay("GenerateRandom", generate_random_member, n, seed);
        };

        window.runAutomatedTests = async () => { /* ... (same test logic, but use verboseLog for details, and displayMain for summary) ... */
            if (!await initializeWasm()) return;
            displayMain("Automated Tests", "Running... Check verbose log for details.", "info");
            verboseLog("Starting Automated Basic Test Suite...", "TestRunner");

            // Ensure S3={0,1,2} for these specific tests
            try { setup_propagator("0,1,2", 3); } catch(e) { verboseLog("Failed to set S3={0,1,2} for tests", "TestRunner"); return;}


            const tests = [
                { name: "PE_N3_X2", func: () => create_paired_entity("2", 3), expect: (r) => r.x === "2" && r.x_prime === "5" && r.n_bits === 3 },
                { name: "IsMember_S6_18_True", func: () => is_member("18", 6), expect: (r) => r === true },
                { name: "Decompose_S6_18", func: () => decompose_to_base("18", 6), expect: (r_arr) => Array.from(r_arr).map(v=>v.toString()).join(',') === "2,2" },
                { name: "Compose_S6_From_[2,2]", func: () => compose_from_base(["2","2"]), expect: (r) => r.value === "18" && r.n_bits === 6 },
                { name: "GenRandom_S6_Valid", func: async () => { const r_str = await generate_random_member(6, 10); return {randomVal: r_str, isMember: await is_member(r_str, 6)}; }, expect: (res) => res.isMember === true && !isNaN(parseInt(res.randomVal)) },
                // Add more critical path tests if needed, keep it relatively short for UI summary
            ];
            let testsPassed = 0; let testsFailed = 0;
            const suiteStartTime = performance.now();

            for (const test of tests) { /* ... (test execution logic, use verboseLog) ... */
                verboseLog(`Running test: ${test.name}`, "TestRunner");
                let result, errorOccurred = false, actualError = null;
                try { result = await test.func(); } 
                catch (e) { errorOccurred = true; actualError = e; }

                if (test.expectError) {
                    if (errorOccurred) { verboseLog(`PASS: ${test.name}`, "TestRunner"); testsPassed++; } 
                    else { verboseLog(`FAIL: ${test.name} - Expected error, got success: ${JSON.stringify(result)}`, "TestRunner"); testsFailed++; }
                } else {
                    if (errorOccurred) { verboseLog(`FAIL: ${test.name} - Expected success, got error: ${String(actualError)}`, "TestRunner"); testsFailed++; } 
                    else {
                        let assertionPassed = false; try { assertionPassed = test.expect(result); } catch (ae) { verboseLog(`FAIL: ${test.name} - Assertion func error: ${ae}`, "TestRunner");}
                        if (assertionPassed) { verboseLog(`PASS: ${test.name}`, "TestRunner"); testsPassed++; } 
                        else { verboseLog(`FAIL: ${test.name} - Assertion failed. Got: ${JSON.stringify(result)}`, "TestRunner"); testsFailed++; }
                    }
                }
            }
            const suiteEndTime = performance.now();
            const totalSuiteTime = (suiteEndTime - suiteStartTime).toFixed(3);
            const summary = `Test Suite: ${testsPassed} passed, ${testsFailed} failed in ${totalSuiteTime} ms.`;
            displayMain("Automated Tests", summary + (testsFailed > 0 ? " Check verbose log for details." : " All OK!"), testsFailed > 0 ? "error" : "ok");
            verboseLog(summary, "TestRunner");
        };
        
        window.runDepthTest = async () => {
            if (!await initializeWasm()) return;
            if (isBenchmarking) {
                displayMain("Depth Test", "Benchmark already in progress.", "info");
                return;
            }
            isBenchmarking = true;
            document.getElementById("depthTestButton").disabled = true;
            benchmarkResultArea.innerHTML = "<p><i>Running depth test... This may take some time.</i></p>";
            verboseLog("Starting Max N Depth Test...", "DepthTest");

            // Force S3={0,1,2}, N_base=3 for this specific test
            try { setup_propagator("0,1,2", 3); } catch(e) { verboseLog("Failed to set S3={0,1,2} for depth test", "DepthTest"); benchmarkResultArea.innerHTML = "<p>Error setting up S3 for test.</p>"; isBenchmarking = false; document.getElementById("depthTestButton").disabled = false; return;}


            const timeLimitMs = parseInt(document.getElementById('depthTestTimeLimit').value) || 500;
            let currentN = 3; // Start from N_base (or first valid level like 2*N_base)
            let maxNReached = 0;
            let results = [];

            // Test up to a practical limit like N=96 or N=192 for this demo
            // Actual theoretical limit is memory for BigUint, but JS/WASM interop will be slow first.
            const N_LEVELS_TO_TEST = [3, 6, 12, 24, 48, 96, 192]; 

            for (const nLevel of N_LEVELS_TO_TEST) {
                currentN = nLevel;
                verboseLog(`DepthTest: Testing N=${currentN}`, "DepthTest");
                let xValStr;
                try {
                    // Generate one random member of S_N
                    const genStartTime = performance.now();
                    xValStr = await generate_random_member(currentN, Date.now() % 1000);
                    const genEndTime = performance.now();
                    verboseLog(`DepthTest: Generated X for N=${currentN} in ${(genEndTime-genStartTime).toFixed(2)}ms: ${xValStr.length > 20 ? xValStr.slice(0,20)+"..." : xValStr}`, "DepthTest");

                    // Time one is_member call
                    const isMemberStartTime = performance.now();
                    const isMem = await is_member(xValStr, currentN);
                    const isMemberEndTime = performance.now();
                    const duration = isMemberEndTime - isMemberStartTime;

                    results.push({ N: currentN, time_ms: duration.toFixed(3), is_member_result: isMem, generated_x_preview: xValStr.slice(0,15) + (xValStr.length > 15 ? "..." : "") });
                    
                    if (duration <= timeLimitMs) {
                        maxNReached = currentN;
                    } else {
                        verboseLog(`DepthTest: N=${currentN} exceeded time limit (${duration.toFixed(2)}ms > ${timeLimitMs}ms). Stopping.`, "DepthTest");
                        break; 
                    }
                } catch (e) {
                    const errorStr = (e instanceof Error) ? `${e.name}: ${e.message}` : String(e);
                    verboseLog(`DepthTest: Error at N=${currentN}: ${errorStr}`, "DepthTest");
                    results.push({ N: currentN, error: errorStr });
                    break; 
                }
            }
            
            benchmarkResultArea.innerHTML = `<h3>Depth Test Results (S3={0,1,2}, N_base=3):</h3>
                <p>Max N reached for generate_random + is_member within ~${timeLimitMs}ms per N: <b>${maxNReached || 'None (or error)'}</b></p>
                <pre>${JSON.stringify(results, null, 2)}</pre>`;
            verboseLog(`Depth Test Finished. Max N for ~${timeLimitMs}ms: ${maxNReached}`, "DepthTest");
            isBenchmarking = false;
            document.getElementById("depthTestButton").disabled = false;
        };
        
        window.drawS6Visualization = async () => { /* ... same as before, use verboseLog and displayMain for summary ... */
            if (!await initializeWasm()) return;

            // Ensure S3={0,1,2} for this specific visualization
             try { setup_propagator("0,1,2", 3); } catch(e) { verboseLog("Failed to set S3={0,1,2} for S6 Viz", "S6Viz"); displayMain("S6 Viz Error: Could not set S3.", "error"); return;}


            const canvas = document.getElementById('s6Canvas');
            const ctx = canvas.getContext('2d');
            const s3Values = [0, 1, 2]; 
            const s6Members = []; 

            for (const h_upper of s3Values) {
                for (const h_lower of s3Values) {
                    try {
                        const composed = compose_from_base([String(h_upper), String(h_lower)]);
                        if (composed && typeof composed.value === 'string' && typeof composed.n_bits === 'number' && composed.n_bits === 6) {
                             s6Members.push({ x_val: parseInt(composed.value), h_upper: h_upper, h_lower: h_lower });
                        } else {
                            verboseLog(`Unexpected compose result for (${h_upper},${h_lower}): ${JSON.stringify(composed)}`, "S6Viz-Setup");
                        }
                    } catch (e) {
                        verboseLog(`Error composing S6 member for (${h_upper},${h_lower}): ${e}`, "S6Viz-Setup");
                    }
                }
            }

            if (s6Members.length !== 9) {
                displayMain("S6 Visualization", `Generated ${s6Members.length}/9 S6 members. Plot may be incomplete.`, "error");
                verboseLog(`Expected 9 S6 members for S3={0,1,2}, but generated ${s6Members.length}.`, "S6Viz");
            }

            const gridSize = 3; 
            const cellPadding = 40;
            const cellSize = (canvas.width - 2 * cellPadding) / gridSize;
            const radius = Math.min(20, cellSize / 3); 
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.font = "10px Segoe UI, sans-serif";
            ctx.textAlign = "center"; ctx.textBaseline = "middle";
            verboseLog(`Plotting ${s6Members.length} S6 members.`, "S6Viz");

            ctx.strokeStyle = "#e0e0e0"; ctx.lineWidth = 0.5;
            for(let i = 0; i <= gridSize; i++) { /* ... (grid drawing logic same as before) ... */ }


            s6Members.forEach(member => { /* ... (point drawing logic same as before) ... */ });
            ctx.lineWidth = 1; 
            displayMain("S6 Visualization", `Plotted ${s6Members.length} S6 members.`, "ok");
        };

        window.toggleFullLog = () => { /* ... same as before ... */ 
            fullOutputLog.style.display = (fullOutputLog.style.display === 'none' || fullOutputLog.style.display === '') ? 'block' : 'none';
            if (fullOutputLog.style.display === 'block') {
                fullOutputLog.scrollTop = fullOutputLog.scrollHeight;
            }
        };
        window.exportFullLog = () => { /* ... same as before ... */
            const blob = new Blob([fullOutputLog.value], { type: 'text/plain' });
            const anchor = document.createElement('a');
            anchor.download = 'paired_binary_log.txt';
            anchor.href = URL.createObjectURL(blob);
            anchor.click();
            URL.revokeObjectURL(anchor.href);
         };
        window.clearFullLog = () => { fullOutputLog.value = ''; };

        initializeWasm();
    </script>
</body>
</html>
